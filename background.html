<script src="preferhttps.js"></script>

<script>
	// Create whitelists and blacklist if they don't exist (first launch)
	var whitelist = [
		"http://www.google.",
		"http://www.linkedin."
	];
	localStorage["hard_whitelist"] = "\\b" + whitelist.join("|\\b");
	if(localStorage["user_whitelist"]==undefined) {
		localStorage["user_whitelist"] = "\\b\\B";
		localStorage["auto_whitelist"] = "\\b\\B";
		localStorage["auto_blacklist"] = "\\b\\B";
	}
	
	if(localStorage["onoff"]==undefined) {
		// Set to ON by default
		localStorage["onoff"] = "on";
	}else if(localStorage["onoff"]=="off") {
		// Change icon if off
		chrome.browserAction.setIcon( {path: "icon_off.png"} );
	}
	
	

	// Catch loading tabs
	chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
		if(localStorage["onoff"]=="on" && changeInfo.status=="loading") {
			// Retreive tab URL
			var old_url = changeInfo.url;
			if(old_url==undefined) old_url = chrome.tabs.get(tabId).url;
			
			// Compute HTTPS URL and redirect if found
			var https_url = computeHttpsUrl(old_url);
			if(https_url != false) loadNewURL(tabId, https_url);
		}
	});
</script>